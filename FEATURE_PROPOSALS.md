# 封筒ツクール 新機能提案

## 実装済みの機能

### ✅ 住所録機能

- ブラウザのLocalStorageに保存（プライバシー保護）
- 登録名を付けて保存可能
- 宛先・差出人それぞれ個別に保存・呼び出し可能
- 住所録一覧から選択して自動入力
- 最終使用日順/名前順/更新日順のソート機能
- 検索機能
- 編集・削除機能
- 汎用的な確認ダイアログ

### ✅ 共有URL機能

- フォームデータをURLのクエリパラメータとして保存
- 1クリックで共有URLを生成・コピー
- URLから自動的にフォームを復元

## 未実装の機能提案

## 住所録のCSV出力・インポート機能

### 概要

住所録データをCSV形式でエクスポート・インポートできる機能。バックアップや他システムとの連携が可能に。

### 機能詳細

- 住所録全体または選択したエントリーをCSV出力
- CSVファイルから住所録への一括インポート
- インポート時の重複チェック（名前ベース）
- インポートプレビュー機能
- エラーレポート表示

### CSVフォーマット例

```csv
登録名,タイプ,郵便番号,住所1,住所2,所属1,所属2,役職,氏名,敬称,最終使用日
自宅,sender,123-4567,東京都千代田区,千代田1-2-3,,,,山田太郎,,2024-01-15T10:30:00Z
会社,destination,234-5678,大阪府大阪市,北区1-2-3,株式会社サンプル,営業部,部長,田中花子,様,2024-01-20T14:00:00Z
```

### UI設計

- 住所録モーダルに「CSVエクスポート」「CSVインポート」ボタンを追加
- インポート時はドラッグ&ドロップまたはファイル選択
- プレビューダイアログで確認後にインポート実行

## 住所検索機能（API連携）

### 概要

Google Places API等の外部APIを使用して、施設名や会社名から住所を検索・自動入力する機能

### 機能詳細

- 施設名・会社名・店舗名からの住所検索
- 郵便番号からの住所自動補完
- 検索履歴のキャッシュ（API呼び出し削減）
- オフライン時は住所録から検索にフォールバック

### 実装案

```typescript
// composables/address-search.ts
interface SearchResult {
  name: string;
  address: string;
  zipcode?: string;
  placeId?: string; // Google Places ID
  source: 'google' | 'postalcode' | 'cache';
}

const useAddressSearch = () => {
  // Google Places Autocomplete API
  const searchByName = async (query: string): Promise<SearchResult[]> => {
    // APIキーはサーバー側で管理（プロキシ経由）
  };
  
  // 郵便番号API（日本郵便提供）
  const searchByZipcode = async (zipcode: string): Promise<SearchResult> => {
    // https://zipcloud.ibsnet.co.jp/api/search
  };
}
```

### セキュリティ考慮事項

- APIキーはサーバー側で管理（直接ブラウザに露出させない）
- プロキシサーバー経由でのAPI呼び出し
- レート制限の実装
- CORS対応

### UI設計

- 検索フィールドにオートコンプリート機能
- 「施設名から検索」ボタン
- 検索結果の候補リスト表示
- 選択後、フォームに自動入力

### プライバシーオプション

- API検索機能のON/OFF設定
- 「完全オフラインモード」の提供
- 検索履歴を保存しないオプション

### 推定利用料金

#### Google Places API

- **Autocomplete - Per Request**: $0.00283/リクエスト（約0.42円）
- **Place Details - Per Request**: $0.017/リクエスト（約2.55円）
- 月間リクエスト数想定：
  - 軽量利用（100件/月）: 約300円
  - 中量利用（1,000件/月）: 約3,000円
  - 大量利用（10,000件/月）: 約30,000円
- **無料枠**: $200/月（約30,000円）のクレジットあり

#### 郵便番号検索API

- **zipcloud API**: 無料（商用利用可）
- **日本郵便 Web API**:
  - 利用料自体は無料
  - **固定IPアドレスが必須**（申請時に登録が必要）
  - 固定IP費用: 月額1,000円〜5,000円程度（プロバイダによる）
  - 商用利用の場合は別途申請が必要

#### コスト最適化案

- キャッシュ実装により同一検索の重複リクエストを削減
- 郵便番号検索を優先し、詳細住所のみGoogle APIを利用
- ユーザーごとの月間API利用上限設定

## QRコード機能

### 概要

共有URLをQRコード化して印刷物に追加できる機能

### 機能詳細

- 共有URLを自動的にQRコード化
- 封筒の余白部分にQRコードを配置（オプション）
- QRコードサイズ調整可能
- 「返信用QRコード」として相手が読み取って返信封筒を作成可能

### 実装案

```typescript
// 必要なライブラリ
// npm install qrcode.js または qr-code-styling

// composables/qr-code.ts
const useQRCode = () => {
  const generateQRCode = async (url: string, options?: QRCodeOptions) => {
    // QRコード生成ロジック
  };
}
```

### 利用シーン

- 返信が必要な封筒に印刷
- 住所変更の通知（新住所のQRコード）
- イベント招待状（会場情報付き）

### マーケティング効果

#### ネットワーク効果

- **受信者のサービス認知**: QRコードを通じて初めて封筒ツクールを知る
- **バイラル拡散**: 便利さを体験した受信者が自分でも利用開始
- **利用者の指数関数的増加**: 各ユーザーが複数の新規ユーザーを獲得

#### ブランディング効果

- **サービス名の自然な露出**: 「封筒ツクールで作成」等の文言をQRコード近くに配置
- **信頼性の向上**: デジタル化された封筒作成による先進的なイメージ
- **差別化要因**: 他の封筒作成サービスにない独自機能

#### 利用促進効果

- **返信率の向上**: QRコードで簡単に返信封筒が作成できることで返信のハードルが下がる
- **継続利用の促進**: 一度体験すると手書きに戻れない利便性
- **口コミ効果**: 「QRコードで住所入力が楽だった」という体験の共有

#### 測定可能な指標

- QRコード読み取り数のトラッキング
- QRコード経由の新規ユーザー獲得率
- 返信封筒作成率
- リテンション率（QRコード経由ユーザー vs 通常ユーザー）

## 封筒一括作成（CSVインポート）機能

### 概要

複数の宛先をCSVファイルから一括インポートして、連続してPDFを生成する機能

### 機能詳細

- CSVファイルのドラッグ&ドロップまたはファイル選択
- CSVフォーマットのテンプレートダウンロード機能
- インポート前のプレビューと編集
- 一括PDF生成（個別ファイルまたは結合）
- エラーレポート（不正なデータの表示）

### CSVフォーマット例

```csv
郵便番号,住所1,住所2,所属1,所属2,役職,氏名,敬称
123-4567,東京都千代田区,千代田1-2-3,株式会社サンプル,営業部,部長,山田太郎,様
```

### 実装案

```typescript
// utils/csv-parser.ts
interface CSVRow {
  destZipcode: string;
  destAddress1: string;
  destAddress2: string;
  // ...
}

const parseCSV = (file: File): Promise<CSVRow[]> => {
  // Papa Parse等のライブラリを使用
};
```

### バリデーション

- 郵便番号フォーマットチェック
- 必須項目の確認
- 文字数制限チェック

## キーボードショートカット

### 概要

作業効率を向上させるキーボードショートカット機能

### ショートカット一覧

| ショートカット | 動作 |
|--------------|------|
| Ctrl/Cmd + P | PDF生成・印刷 |
| Ctrl/Cmd + S | 現在の入力内容を住所録に登録 |
| Ctrl/Cmd + N | フォームをクリア（新規作成） |
| Ctrl/Cmd + L | 住所録一覧を開く |
| Tab | 次の入力欄へ移動 |
| Shift + Tab | 前の入力欄へ移動 |
| Ctrl/Cmd + Z | 最後の入力を元に戻す |
| ? | ショートカット一覧を表示 |

### 実装案

```typescript
// composables/keyboard-shortcuts.ts
const useKeyboardShortcuts = () => {
  const registerShortcuts = () => {
    useEventListener('keydown', (e: KeyboardEvent) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
        e.preventDefault();
        generatePDF();
      }
      // 他のショートカット
    });
  };
}
```

### UI表示

- 画面右下に「?」アイコンでヘルプ表示
- ボタンホバー時にショートカットをツールチップで表示

## 履歴機能

### 概要

最近作成した封筒の履歴を表示し、簡単に再利用できる機能

### 機能詳細

- 最新20件の作成履歴を保存（LocalStorage）
- サムネイル付き履歴一覧
- 履歴から選択して再編集
- 履歴の削除（個別/全削除）
- 作成日時の表示

### 実装案

```typescript
// composables/history.ts
interface EnvelopeHistory {
  id: string;
  formData: DestForm & SenderForm;
  createdAt: string;
  thumbnail?: string; // Base64エンコードされたサムネイル
}

const useHistory = () => {
  const history = useLocalStorage<EnvelopeHistory[]>('envelope-history', []);
  const maxHistoryItems = 20;
  
  const addToHistory = (formData: DestForm & SenderForm) => {
    // 履歴に追加（古いものから削除）
  };
}
```

### UI設計

- ヘッダーに「履歴」ボタンを配置
- スライドパネルで履歴一覧を表示
- 各履歴項目には以下を表示：
  - 宛先名
  - 作成日時
  - 「この内容で作成」ボタン
  - 削除ボタン

### プライバシー配慮

- 履歴機能のON/OFF設定
- 「シークレットモード」（履歴を残さない）
- 履歴の自動削除期間設定（例：30日後）

## 実装優先順位の提案

1. **履歴機能** - 最も利用頻度が高く、実装も比較的シンプル
2. **住所録のCSV出力・インポート機能** - 既存の住所録機能の拡張で実装しやすい
3. **住所検索機能** - UXを大幅に向上、ただしサーバー側の実装が必要
4. **キーボードショートカット** - 実装が簡単で、パワーユーザーの満足度向上
5. **封筒一括作成機能** - 業務利用での需要が高い
6. **QRコード機能** - 特定用途向けだが、差別化要素になる

## 技術的な考慮事項

### LocalStorage容量

- 履歴と住所録で使用するLocalStorageの容量管理
- 上限（通常5-10MB）に近づいた場合の対処

### パフォーマンス

- CSV大量インポート時の処理最適化
- Web Workerの活用検討

### ブラウザ互換性

- LocalStorage対応確認
- キーボードイベントのクロスブラウザ対応
- QRコード生成ライブラリの選定

### セキュリティ

- CSVアップロード時のバリデーション強化
- XSS対策（特に履歴表示時）
- API連携時のセキュリティ（APIキー管理、HTTPS通信）
- 外部API利用時の個人情報保護

### API連携の考慮事項

- サーバーレス関数（Vercel Functions、Netlify Functions等）の利用
- APIキーの環境変数管理
- キャッシュ戦略（Redis等）
- フェイルオーバー（API障害時の対応）
